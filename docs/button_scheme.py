"""
ะะพะบัะผะตะฝัะฐัะธั ััะตะผั ะบะฝะพะฟะพะบ ะธ ัะพััะพัะฝะธะน ะฑะพัะฐ.
ะญัะพั ัะฐะนะป ะธัะฟะพะปัะทัะตััั ัะพะปัะบะพ ะบะฐะบ ะดะพะบัะผะตะฝัะฐัะธั ะธ ะฝะต ะธะผะฟะพััะธััะตััั ะฒ ะบะพะด.
"""
from enum import Enum, auto
from dataclasses import dataclass
from typing import List, Optional


class BotState(Enum):
    """ะกะพััะพัะฝะธั ะฑะพัะฐ."""
    # ะัะฝะพะฒะฝัะต ัะพััะพัะฝะธั
    POST_VIEW = auto()           # ะะฐัะฐะปัะฝะพะต ัะพััะพัะฝะธะต ะฟัะพัะผะพััะฐ ะฟะพััะฐ
    MODERATE_MENU = auto()       # ะะตะฝั ะผะพะดะตัะฐัะธะธ
    CONFIRM_PUBLISH = auto()     # ะะพะดัะฒะตัะถะดะตะฝะธะต ะฟัะฑะปะธะบะฐัะธะธ
    CONFIRM_DELETE = auto()      # ะะพะดัะฒะตัะถะดะตะฝะธะต ัะดะฐะปะตะฝะธั
    QUICK_DELETE = auto()        # ะััััะพะต ัะดะฐะปะตะฝะธะต
    
    # ะกะพััะพัะฝะธั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั
    EDIT_MENU = auto()           # ะะตะฝั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั
    EDIT_TEXT_WAIT = auto()      # ะะถะธะดะฐะฝะธะต ะฝะพะฒะพะณะพ ัะตะบััะฐ
    EDIT_TEXT_CONFIRM = auto()   # ะะพะดัะฒะตัะถะดะตะฝะธะต ะฝะพะฒะพะณะพ ัะตะบััะฐ
    EDIT_MEDIA_MENU = auto()     # ะะตะฝั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั ะผะตะดะธะฐ
    EDIT_MEDIA_ADD_WAIT = auto() # ะะถะธะดะฐะฝะธะต ะฝะพะฒัั ัะพัะพ
    EDIT_MEDIA_ADD_CONFIRM = auto() # ะะพะดัะฒะตัะถะดะตะฝะธะต ะฝะพะฒัั ัะพัะพ
    EDIT_MEDIA_REMOVE_WAIT = auto() # ะะถะธะดะฐะฝะธะต ะฝะพะผะตัะพะฒ ัะพัะพ ะดะปั ัะดะฐะปะตะฝะธั
    EDIT_MEDIA_REMOVE_CONFIRM = auto() # ะะพะดัะฒะตัะถะดะตะฝะธะต ัะดะฐะปะตะฝะธั ัะพัะพ


@dataclass
class PostContext:
    """ะะพะฝัะตะบัั ะฟะพััะฐ."""
    post_id: str
    chat_id: int
    message_id: int
    state: BotState
    original_text: Optional[str] = None
    original_media: Optional[List[int]] = None
    temp_text: Optional[str] = None
    temp_media: Optional[List[int]] = None
    media_to_remove: Optional[List[int]] = None


class StateManager:
    """ะะตะฝะตะดะถะตั ัะพััะพัะฝะธะน."""
    
    def __init__(self):
        """ะะฝะธัะธะฐะปะธะทะฐัะธั ะผะตะฝะตะดะถะตัะฐ ัะพััะพัะฝะธะน."""
        self._posts: dict[str, PostContext] = {}
    
    def get_post_context(self, post_id: str) -> Optional[PostContext]:
        """ะะพะปััะธัั ะบะพะฝัะตะบัั ะฟะพััะฐ."""
        return self._posts.get(post_id)
    
    def set_post_context(self, post_id: str, context: PostContext) -> None:
        """ะฃััะฐะฝะพะฒะธัั ะบะพะฝัะตะบัั ะฟะพััะฐ."""
        self._posts[post_id] = context
    
    def clear_post_context(self, post_id: str) -> None:
        """ะัะธััะธัั ะบะพะฝัะตะบัั ะฟะพััะฐ."""
        if post_id in self._posts:
            del self._posts[post_id]


"""
ะกัะตะผะฐ ะฟะตัะตัะพะดะพะฒ ัะพััะพัะฝะธะน:

[ะะะกะข_VIEW]
โ
โโโ โ ะะพะดะตัะธัะพะฒะฐัั โ MODERATE_MENU
โ     โโโ โ ะะฟัะฑะปะธะบะพะฒะฐัั โ CONFIRM_PUBLISH
โ     โ     โโโ โ ะะฐ   โ ัะดะฐะปะตะฝะธะต ะบะฝะพะฟะพะบ, ัะพะพะฑัะตะฝะธะต ะพ ะฟัะฑะปะธะบะฐัะธะธ
โ     โ     โโโ โ ะะตั  โ ะฒะพะทะฒัะฐั ะบ POST_VIEW
โ     โ
โ     โโโ โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั โ EDIT_MENU
โ     โ     โโโ ะขะตะบัั โ EDIT_TEXT_WAIT
โ     โ     โ     โโโ [ะะฒะพะด ัะตะบััะฐ] โ EDIT_TEXT_CONFIRM
โ     โ     โ     โ     โโโ โ ะะฐ   โ ัะพััะฐะฝะตะฝะธะต, ะฒะพะทะฒัะฐั ะบ POST_VIEW
โ     โ     โ     โ     โโโ โ ะะตั  โ ะฒะพะทะฒัะฐั ะบ EDIT_MENU
โ     โ     โ
โ     โ     โโโ ๐ผ ะะตะดะธะฐ โ EDIT_MEDIA_MENU
โ     โ     โ     โโโ ะะพะฑะฐะฒะธัั โ EDIT_MEDIA_ADD_WAIT
โ     โ     โ     โ     โโโ [ะะฒะพะด ัะพัะพ] โ EDIT_MEDIA_ADD_CONFIRM
โ     โ     โ     โ     โ     โโโ โ ะะฐ   โ ัะพััะฐะฝะตะฝะธะต, ะฒะพะทะฒัะฐั ะบ POST_VIEW
โ     โ     โ     โ     โ     โโโ โ ะะตั  โ ะฒะพะทะฒัะฐั ะบ EDIT_MEDIA_MENU
โ     โ     โ     โ
โ     โ     โ     โโโ ะฃะดะฐะปะธัั โ EDIT_MEDIA_REMOVE_WAIT
โ     โ     โ           โโโ [ะะฒะพะด ะฝะพะผะตัะพะฒ] โ EDIT_MEDIA_REMOVE_CONFIRM
โ     โ     โ           โ     โโโ โ ะะฐ   โ ัะดะฐะปะตะฝะธะต, ะฒะพะทะฒัะฐั ะบ POST_VIEW
โ     โ     โ           โ     โโโ โ ะะตั  โ ะฒะพะทะฒัะฐั ะบ EDIT_MEDIA_MENU
โ     โ     โ
โ     โ     โโโ ๐ ะะฐะทะฐะด โ MODERATE_MENU
โ     โ
โ     โโโ โ ะฃะดะฐะปะธัั โ CONFIRM_DELETE
โ           โโโ โ ะะฐ   โ ัะดะฐะปะตะฝะธะต ะฟะพััะฐ ะธ ัะพัะพ
โ           โโโ โ ะะตั  โ ะฒะพะทะฒัะฐั ะบ MODERATE_MENU
โ
โโโ โ ะฃะดะฐะปะธัั โ QUICK_DELETE
      โโโ โ ะะฐ   โ ัะดะฐะปะตะฝะธะต ะฟะพััะฐ ะธ ัะพัะพ
      โโโ โ ะะตั  โ ะฒะพะทะฒัะฐั ะบ POST_VIEW

ะัะฐะฒะธะปะฐ ัะฐะฑะพัั ั ะบะฝะพะฟะบะฐะผะธ:
1. ะัะตะณะดะฐ ัะฒะตัััััั ัะพ ััะตะผะพะน ะฟัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฝะพะฒัั ะบะฝะพะฟะพะบ ะธะปะธ ะธะทะผะตะฝะตะฝะธะธ ัััะตััะฒัััะธั
2. ะะฐะถะดะพะต ัะพััะพัะฝะธะต ะดะพะปะถะฝะพ ะธะผะตัั ัะตัะบะธะน ะฟะตัะตัะพะด ะฒ ะดััะณะพะต ัะพััะพัะฝะธะต
3. ะัะต ะฟะพะดัะฒะตัะถะดะตะฝะธั ัะตะฐะปะธะทััััั ัะตัะตะท ะพัะดะตะปัะฝัะต ะบะปะฐะฒะธะฐัััั ั "ะะฐ/ะะตั"
4. ะะพัะปะต ะฟัะฑะปะธะบะฐัะธะธ ะธะปะธ ัะดะฐะปะตะฝะธั ะฒัะตะณะดะฐ ะฟะพะบะฐะทัะฒะฐะตััั ัะปัะถะตะฑะฝะพะต ัะพะพะฑัะตะฝะธะต
5. ะัะธ ะพัะผะตะฝะต ะดะตะนััะฒะธะน ะฒะพะทะฒัะฐัะฐัััั ะบ ะฟัะตะดัะดััะตะผั ัะพััะพัะฝะธั
6. ะัะต ะฒัะตะผะตะฝะฝัะต ะดะฐะฝะฝัะต ััะฐะฝะธัั ะฒ ะบะพะฝัะตะบััะต ะฟะพััะฐ
7. ะัะธัะฐัั ะบะพะฝัะตะบัั ะฟะพัะปะต ะทะฐะฒะตััะตะฝะธั ะพะฟะตัะฐัะธะน
""" 